# íŠ¸ëŸ¬ë¸”ìŠˆíŒ…: ê°•ì˜ ìƒì„± API 400 ì—ëŸ¬ ë° schedules null ë¬¸ì œ

## ğŸ“‹ ëª©ì°¨
1. [ë¬¸ì œ ìƒí™©](#ë¬¸ì œ-ìƒí™©)
2. [ì´ˆê¸° ì¦ìƒ](#ì´ˆê¸°-ì¦ìƒ)
3. [íŠ¸ëŸ¬ë¸”ìŠˆíŒ… ê³¼ì •](#íŠ¸ëŸ¬ë¸”ìŠˆíŒ…-ê³¼ì •)
4. [ìµœì¢… í•´ê²° ë°©ë²•](#ìµœì¢…-í•´ê²°-ë°©ë²•)
5. [ë°°ìš´ ì ê³¼ ì˜ˆë°©ë²•](#ë°°ìš´-ì ê³¼-ì˜ˆë°©ë²•)

---

## ë¬¸ì œ ìƒí™©

### ë°œìƒ ì‹œì 
- 2026-01-05
- ê°•ì˜ ìƒì„± API(`POST /api/v1/lecture`) ê°œë°œ í›„ í…ŒìŠ¤íŠ¸ ì¤‘

### ìš”ì²­ ë‚´ìš©
```bash
curl -X POST 'http://localhost:8080/api/v1/lecture' \
  -H 'Content-Type: application/json' \
  -d '{
  "title": "string",
  "lectureType": "ACADEMY",
  "subject": "KOREAN",
  "scheduleRequest": [
    {
      "dayOfWeek": "MONDAY",
      "startTime": "15:00:00",
      "endTime": "17:00:00"
    }
  ]
}'
```

### ì˜ˆìƒ ê²°ê³¼
- HTTP 200 OK
- ìƒì„±ëœ ê°•ì˜ ì •ë³´ì™€ ìŠ¤ì¼€ì¤„ ëª©ë¡ ë°˜í™˜

### ì‹¤ì œ ê²°ê³¼
- HTTP 400 Bad Request
- ì—ëŸ¬ ì‘ë‹µ ë°˜í™˜

---

## ì´ˆê¸° ì¦ìƒ

### 1ì°¨ ë¬¸ì œ: HTTP 400 Bad Request
```
ì‘ë‹µ ì½”ë“œ: 400
ì‘ë‹µ ë³¸ë¬¸: (ì—ëŸ¬ ë©”ì‹œì§€)
```

**ì˜ë¬¸ì :**
- JSON í˜•ì‹ì€ ì˜¬ë°”ë¥¸ê°€?
- DTO ë§¤í•‘ì´ ì œëŒ€ë¡œ ë˜ëŠ”ê°€?
- ìœ íš¨ì„± ê²€ì¦ ë¬¸ì œì¸ê°€?

---

## íŠ¸ëŸ¬ë¸”ìŠˆíŒ… ê³¼ì •

### 1ë‹¨ê³„: ì½”ë“œ ë¦¬ë·° ë° ê¸°ë³¸ ê²€ì¦

#### ì ‘ê·¼ ë°©ë²•
1. **DTO êµ¬ì¡° í™•ì¸**
   - LectureRequest.java í™•ì¸
   - LectureScheduleRequest.java í™•ì¸

#### ë°œê²¬ ì‚¬í•­

**LectureRequest.java (Line 14-16)**
```java
@Getter
@NoArgsConstructor  // ê¸°ë³¸ ìƒì„±ìë§Œ ìˆìŒ
@AllArgsConstructor
public class LectureRequest {
```

**ë¬¸ì œì  1:** `@Setter`ê°€ ì—†ìŒ!

**ì´ë¡ :**
- Jacksonì€ JSONì„ ê°ì²´ë¡œ ë³€í™˜í•  ë•Œ:
  1. `@NoArgsConstructor`ë¡œ ë¹ˆ ê°ì²´ ìƒì„±
  2. **Setter ë©”ì„œë“œë¡œ í•„ë“œ ê°’ ì„¤ì •** â† ì—¬ê¸°ì„œ ì‹¤íŒ¨!
- Setterê°€ ì—†ìœ¼ë©´ í•„ë“œì— ê°’ì„ ì£¼ì…í•  ìˆ˜ ì—†ìŒ

#### 1ì°¨ í•´ê²° ì‹œë„: @Setter ì¶”ê°€

```java
@Getter
@Setter  // ì¶”ê°€
@NoArgsConstructor
@AllArgsConstructor
public class LectureRequest {
```

**ê²°ê³¼:** ì—¬ì „íˆ 400 ì—ëŸ¬ ë°œìƒ âŒ

---

### 2ë‹¨ê³„: ë” ê¹Šì€ ì›ì¸ ë¶„ì„

#### ì ‘ê·¼ ë°©ë²•
1. **LectureScheduleRequest êµ¬ì¡° í™•ì¸**
   - Record íƒ€ì…ì¸ì§€ í™•ì¸
   - Jacksonê³¼ì˜ í˜¸í™˜ì„± ê²€í† 

#### ë°œê²¬ ì‚¬í•­

**LectureScheduleRequest.java (Line 11-16)**
```java
public record LectureScheduleRequest(
    DayOfWeek dayOfWeek,
    LocalTime startTime,
    LocalTime endTime
) {
}
```

**ë¬¸ì œì  2:** Java Record íƒ€ì…!

**ì´ë¡ :**
- Java RecordëŠ” ë¶ˆë³€ ê°ì²´
- Jacksonì´ Recordë¥¼ ì—­ì§ë ¬í™”í•˜ë ¤ë©´:
  1. Canonical ìƒì„±ìì˜ **íŒŒë¼ë¯¸í„° ì´ë¦„**ì„ ì•Œì•„ì•¼ í•¨
  2. JSON í•„ë“œëª…ê³¼ íŒŒë¼ë¯¸í„°ëª…ì„ ë§¤ì¹­
  3. í•˜ì§€ë§Œ ì»´íŒŒì¼ ì‹œ íŒŒë¼ë¯¸í„° ì´ë¦„ì´ ê¸°ë³¸ì ìœ¼ë¡œ **ì œê±°ë¨**!

**ë¶„ì„ ë„êµ¬:**
```bash
# ì»´íŒŒì¼ëœ .class íŒŒì¼ì— parameter namesê°€ ìˆëŠ”ì§€ í™•ì¸
javap -v LectureScheduleRequest.class | grep -A 5 "MethodParameters"
```

**ë°œê²¬:** parameter namesê°€ ì—†ìŒ â†’ Jacksonì´ ë§¤ì¹­ ë¶ˆê°€ëŠ¥

#### 2ì°¨ í•´ê²° ì‹œë„: ì»´íŒŒì¼ ì˜µì…˜ ì¶”ê°€

**build.gradle ìˆ˜ì •**
```gradle
// Java Recordë¥¼ Jacksonì—ì„œ ì œëŒ€ë¡œ ì—­ì§ë ¬í™”í•˜ê¸° ìœ„í•œ ì„¤ì •
tasks.withType(JavaCompile).configureEach {
    options.compilerArgs << '-parameters'
}
```

**ì´ ì˜µì…˜ì˜ ì—­í• :**
- ì»´íŒŒì¼ ì‹œ ë©”ì„œë“œ/ìƒì„±ìì˜ íŒŒë¼ë¯¸í„° ì´ë¦„ì„ ë°”ì´íŠ¸ì½”ë“œì— ë³´ì¡´
- Jacksonì´ ë¦¬í”Œë ‰ì…˜ìœ¼ë¡œ íŒŒë¼ë¯¸í„° ì´ë¦„ì„ ì½ì„ ìˆ˜ ìˆê²Œ ë¨

**ì ìš© ë°©ë²•:**
```bash
./gradlew clean build
./gradlew bootRun
```

**í…ŒìŠ¤íŠ¸:**
```bash
curl -X POST http://localhost:8080/api/v1/lecture \
  -H 'Content-Type: application/json' \
  -d '{"title":"ê³ ë“± ìˆ˜í•™","lectureType":"ACADEMY","subject":"KOREAN","scheduleRequest":[...]}'
```

**ê²°ê³¼:** HTTP 200 âœ… - 400 ì—ëŸ¬ í•´ê²°!

---

### 3ë‹¨ê³„: 2ì°¨ ë¬¸ì œ ë°œê²¬ - schedulesê°€ null

#### ì¦ìƒ
```json
{
  "id": 5,
  "title": "ê³ ë“± ìˆ˜í•™",
  "lectureType": "ACADEMY",
  "subject": "KOREAN",
  "schedules": null,  // â† ë¬¸ì œ!
  "createAt": "2026-01-05T22:40:57.497013",
  "updateAt": "2026-01-05T22:40:57.497013"
}
```

**ì˜ë¬¸ì :**
- DBì—ëŠ” ìŠ¤ì¼€ì¤„ì´ ì €ì¥ë˜ì—ˆëŠ”ê°€?
- ì¡°íšŒëŠ” ë˜ëŠ”ë° ì‘ë‹µì—ì„œë§Œ nullì¸ê°€?
- ì§€ì—° ë¡œë”© ë¬¸ì œì¸ê°€?

#### ì ‘ê·¼ ë°©ë²•

1. **ì„œë¹„ìŠ¤ ë¡œì§ í™•ì¸**

**LectureServiceImpl.java (Line 22-34)**
```java
@Transactional
public LectureResponse createLecture(LectureRequest req) {
    Lecture lecture = req.toLecture();
    List<LectureSchedule> lectureSchedules = req.toLectureSchedules();

    for (LectureSchedule lectureSchedule : lectureSchedules) {
        lecture.addSchedule(lectureSchedule);  // ì–‘ë°©í–¥ ê´€ê³„ ì„¤ì •
    }

    Lecture saved = lectureRepository.save(lecture);  // cascadeë¡œ ì €ì¥
    return LectureResponse.from(saved);  // DTO ë³€í™˜
}
```

**ë¡œì§ì€ ì •ìƒ:** cascadeë¡œ ì €ì¥ê¹Œì§€ ì™„ë£Œ

2. **ì—”í‹°í‹° ì„¤ì • í™•ì¸**

**Lecture.java (Line 40-42)**
```java
@OneToMany(mappedBy = "lecture",
           cascade = CascadeType.ALL,
           orphanRemoval = true)
@Builder.Default
private List<LectureSchedule> schedules = new ArrayList<>();
```

**LectureSchedule.java (Line 21-23)**
```java
@ManyToOne(fetch = FetchType.LAZY)  // â† ë¬¸ì œ!
@JoinColumn(name = "lecture_id", nullable = false)
private Lecture lecture;
```

**ë¬¸ì œì  3:** LAZY ë¡œë”© ì „ëµ

**ì´ë¡ :**
- `FetchType.LAZY`: ì—°ê´€ ì—”í‹°í‹°ë¥¼ ì‹¤ì œ ì‚¬ìš©í•  ë•Œê¹Œì§€ ì¡°íšŒí•˜ì§€ ì•ŠìŒ
- í”„ë¡ì‹œ ê°ì²´ë¡œ ëŒ€ì²´
- íŠ¸ëœì­ì…˜ ë°–ì—ì„œ í”„ë¡ì‹œ ì ‘ê·¼ ì‹œ `LazyInitializationException` ë˜ëŠ” null

**í˜„ì¬ ìƒí™© ë¶„ì„:**
```java
@Transactional  // íŠ¸ëœì­ì…˜ ì‹œì‘
public LectureResponse createLecture(LectureRequest req) {
    // ...
    Lecture saved = lectureRepository.save(lecture);
    return LectureResponse.from(saved);
    // ì—¬ê¸°ì„œ schedulesëŠ” LAZY í”„ë¡ì‹œ ìƒíƒœ
}  // íŠ¸ëœì­ì…˜ ì¢…ë£Œ

// Controllerì—ì„œ JSON ì§ë ¬í™” ì‹œë„
// íŠ¸ëœì­ì…˜ ë°– â†’ schedules ì ‘ê·¼ ë¶ˆê°€ â†’ null
```

3. **LectureResponse êµ¬ì¡° í™•ì¸**

**LectureResponse.java (Line 24)**
```java
private List<LectureSchedule> schedules;  // ì—”í‹°í‹° ì§ì ‘ ë°˜í™˜!
```

**ë¬¸ì œì  4:** ì—”í‹°í‹°ë¥¼ ì§ì ‘ JSONìœ¼ë¡œ ë°˜í™˜

**ì—¬ëŸ¬ ë¬¸ì œ ë°œìƒ:**
1. **ì–‘ë°©í–¥ ê´€ê³„** â†’ ìˆœí™˜ ì°¸ì¡° ìœ„í—˜
   ```
   Lecture â†’ schedules â†’ LectureSchedule â†’ lecture â†’ schedules â†’ ...
   ```
2. **LAZY í”„ë¡ì‹œ** â†’ Jacksonì´ ì§ë ¬í™” ì‹¤íŒ¨
3. **ì—”í‹°í‹° ë…¸ì¶œ** â†’ API ìŠ¤í™ì´ ì—”í‹°í‹° êµ¬ì¡°ì— ì¢…ì†

---

### 4ë‹¨ê³„: DTO íŒ¨í„´ ì ìš©

#### í•´ê²° ì „ëµ
1. **LectureScheduleResponse DTO ìƒì„±** - ì—”í‹°í‹° ëŒ€ì‹  DTO ë°˜í™˜
2. **LectureResponse ìˆ˜ì •** - ì—”í‹°í‹° ëŒ€ì‹  DTO ì‚¬ìš©
3. **LAZY ì»¬ë ‰ì…˜ ì´ˆê¸°í™”** - íŠ¸ëœì­ì…˜ ë‚´ì—ì„œ ê°•ì œ ë¡œë”©

#### êµ¬í˜„

**1. LectureScheduleResponse.java ìƒì„±**
```java
@Data
@NoArgsConstructor
@AllArgsConstructor
@Builder
public class LectureScheduleResponse {
    private Long id;
    private DayOfWeek dayOfWeek;
    private LocalTime startTime;
    private LocalTime endTime;

    public static LectureScheduleResponse from(LectureSchedule schedule) {
        return LectureScheduleResponse.builder()
                .id(schedule.getId())
                .dayOfWeek(schedule.getDayOfWeek())
                .startTime(schedule.getStartTime())
                .endTime(schedule.getEndTime())
                .build();
    }
}
```

**ì¥ì :**
- ìˆœí™˜ ì°¸ì¡° ë¬¸ì œ í•´ê²°
- ì—”í‹°í‹° ë³€ê²½ì´ API ìŠ¤í™ì— ì˜í–¥ ì—†ìŒ
- í•„ìš”í•œ í•„ë“œë§Œ ë…¸ì¶œ

**2. LectureResponse.java ìˆ˜ì •**
```java
public class LectureResponse {
    // ë³€ê²½ ì „
    private List<LectureSchedule> schedules;  // âŒ

    // ë³€ê²½ í›„
    private List<LectureScheduleResponse> schedules;  // âœ…

    public static LectureResponse from(Lecture lecture) {
        return LectureResponse.builder()
                // ...
                .schedules(lecture.getSchedules().stream()
                        .map(LectureScheduleResponse::from)  // DTO ë³€í™˜
                        .collect(Collectors.toList()))
                .build();
    }
}
```

**3. LectureServiceImpl.java ìˆ˜ì •**
```java
@Transactional
public LectureResponse createLecture(LectureRequest req) {
    // ...
    Lecture saved = lectureRepository.save(lecture);

    // LAZY ë¡œë”©ëœ schedules ì»¬ë ‰ì…˜ì„ ê°•ì œë¡œ ì´ˆê¸°í™”
    saved.getSchedules().size();  // âœ… íŠ¸ëœì­ì…˜ ë‚´ì—ì„œ ì´ˆê¸°í™”

    return LectureResponse.from(saved);
}
```

**ì™œ size()ë¥¼ í˜¸ì¶œí•˜ë‚˜?**
- í”„ë¡ì‹œ ê°ì²´ì— ì ‘ê·¼í•˜ë©´ ì‹¤ì œ ì¿¼ë¦¬ ì‹¤í–‰
- `size()`, `isEmpty()`, `iterator()` ë“± ì–´ë–¤ ë©”ì„œë“œë“  ê°€ëŠ¥
- íŠ¸ëœì­ì…˜ ë‚´ì—ì„œ í˜¸ì¶œí•´ì•¼ í•¨

**í…ŒìŠ¤íŠ¸:**
```bash
curl -X POST http://localhost:8080/api/v1/lecture \
  -H 'Content-Type: application/json' \
  -d '{"title":"ê³ ë“± ì˜ì–´","lectureType":"ACADEMY","subject":"ENGLISH","scheduleRequest":[...]}'
```

**ê²°ê³¼:**
```json
{
  "id": 2,
  "title": "ê³ ë“± ì˜ì–´",
  "lectureType": "ACADEMY",
  "subject": "ENGLISH",
  "schedules": [  // âœ… ì •ìƒ ë°˜í™˜!
    {
      "id": 4,
      "dayOfWeek": "MONDAY",
      "startTime": "15:00:00",
      "endTime": "17:00:00"
    },
    {
      "id": 5,
      "dayOfWeek": "WEDNESDAY",
      "startTime": "15:00:00",
      "endTime": "17:00:00"
    }
  ],
  "createdAt": "2026-01-05T22:48:31.233382",
  "updatedAt": "2026-01-05T22:48:31.233382"
}
```

**ì„±ê³µ!** âœ…

---

### 5ë‹¨ê³„: ì½”ë“œ í’ˆì§ˆ ê°œì„ 

#### ë°œê²¬í•œ ì¶”ê°€ ë¬¸ì œ
```json
{
  "createAt": "...",  // âŒ ì˜ëª»ëœ ì˜ì–´
  "updateAt": "..."   // âŒ ì˜ëª»ëœ ì˜ì–´
}
```

**ìˆ˜ì •:**
- `createAt` â†’ `createdAt`
- `updateAt` â†’ `updatedAt`

**ì ìš© ìœ„ì¹˜:**
- LectureResponse.java í•„ë“œëª… ë° ë¹Œë” ë©”ì„œë“œ

---

## ìµœì¢… í•´ê²° ë°©ë²•

### ìˆ˜ì •ëœ íŒŒì¼ ìš”ì•½

| íŒŒì¼ | ìˆ˜ì • ë‚´ìš© | ì´ìœ  |
|-----|----------|------|
| **build.gradle** | `-parameters` ì»´íŒŒì¼ ì˜µì…˜ ì¶”ê°€ | Record íŒŒë¼ë¯¸í„° ì´ë¦„ ë³´ì¡´ |
| **LectureRequest.java** | `@Setter` ì¶”ê°€ | Jackson ì—­ì§ë ¬í™” ì§€ì› |
| **LectureScheduleResponse.java** | ì‹ ê·œ DTO ìƒì„± | ìˆœí™˜ ì°¸ì¡° ë°©ì§€, ì—”í‹°í‹° ë³´í˜¸ |
| **LectureResponse.java** | DTO ì‚¬ìš©, í•„ë“œëª… ìˆ˜ì • | LAZY í”„ë¡ì‹œ ë¬¸ì œ í•´ê²°, ì˜ì–´ ìˆ˜ì • |
| **LectureServiceImpl.java** | LAZY ì»¬ë ‰ì…˜ ì´ˆê¸°í™” | íŠ¸ëœì­ì…˜ ë‚´ ë°ì´í„° ë¡œë”© |

### í•µì‹¬ ë³€ê²½ ì‚¬í•­

#### 1. build.gradle
```gradle
tasks.withType(JavaCompile).configureEach {
    options.compilerArgs << '-parameters'
}
```

#### 2. LectureRequest.java
```java
@Getter
@Setter  // ì¶”ê°€
@NoArgsConstructor
@AllArgsConstructor
public class LectureRequest {
```

#### 3. LectureScheduleResponse.java (ì‹ ê·œ)
```java
@Data
@Builder
public class LectureScheduleResponse {
    private Long id;
    private DayOfWeek dayOfWeek;
    private LocalTime startTime;
    private LocalTime endTime;

    public static LectureScheduleResponse from(LectureSchedule schedule) {
        // ì—”í‹°í‹° â†’ DTO ë³€í™˜
    }
}
```

#### 4. LectureResponse.java
```java
public class LectureResponse {
    private List<LectureScheduleResponse> schedules;  // DTO ì‚¬ìš©
    private LocalDateTime createdAt;  // í•„ë“œëª… ìˆ˜ì •
    private LocalDateTime updatedAt;  // í•„ë“œëª… ìˆ˜ì •

    public static LectureResponse from(Lecture lecture) {
        return LectureResponse.builder()
                .schedules(lecture.getSchedules().stream()
                        .map(LectureScheduleResponse::from)
                        .collect(Collectors.toList()))
                .createdAt(lecture.getCreatedAt())
                .updatedAt(lecture.getUpdatedAt())
                .build();
    }
}
```

#### 5. LectureServiceImpl.java
```java
@Transactional
public LectureResponse createLecture(LectureRequest req) {
    Lecture lecture = req.toLecture();
    List<LectureSchedule> lectureSchedules = req.toLectureSchedules();

    for (LectureSchedule lectureSchedule : lectureSchedules) {
        lecture.addSchedule(lectureSchedule);
    }

    Lecture saved = lectureRepository.save(lecture);

    // LAZY ë¡œë”© ì´ˆê¸°í™”
    saved.getSchedules().size();

    return LectureResponse.from(saved);
}
```

---

## ë°°ìš´ ì ê³¼ ì˜ˆë°©ë²•

### 1. Java Recordì™€ Jackson

**ë¬¸ì œ:**
- Record íƒ€ì…ì„ JSONìœ¼ë¡œ ì—­ì§ë ¬í™”í•  ë•Œ íŒŒë¼ë¯¸í„° ì´ë¦„ì´ í•„ìš”
- ê¸°ë³¸ ì»´íŒŒì¼ ì„¤ì •ì€ íŒŒë¼ë¯¸í„° ì´ë¦„ì„ ì œê±°

**í•´ê²°:**
- `-parameters` ì»´íŒŒì¼ ì˜µì…˜ ì¶”ê°€
- ë˜ëŠ” `@JsonCreator` + `@JsonProperty` ëª…ì‹œì  ì§€ì •

**ì˜ˆë°©ë²•:**
```gradle
// build.gradleì— í•­ìƒ ì¶”ê°€
tasks.withType(JavaCompile).configureEach {
    options.compilerArgs << '-parameters'
}
```

**ëŒ€ì•ˆ:**
- Record ëŒ€ì‹  ì¼ë°˜ í´ë˜ìŠ¤ ì‚¬ìš©
- `@JsonCreator`ë¡œ ëª…ì‹œì  ìƒì„±ì ì§€ì •

### 2. LAZY ë¡œë”©ê³¼ íŠ¸ëœì­ì…˜ ê²½ê³„

**ë¬¸ì œ:**
- LAZY ë¡œë”©ëœ ì—”í‹°í‹°ë¥¼ íŠ¸ëœì­ì…˜ ë°–ì—ì„œ ì ‘ê·¼
- í”„ë¡ì‹œ ì´ˆê¸°í™” ì‹¤íŒ¨ â†’ null ë˜ëŠ” ì˜ˆì™¸

**í•´ê²°:**
1. **íŠ¸ëœì­ì…˜ ë‚´ì—ì„œ ì´ˆê¸°í™”**
   ```java
   @Transactional
   public SomeDTO getEntity(Long id) {
       Entity entity = repository.findById(id).orElseThrow();
       entity.getLazyCollection().size();  // ê°•ì œ ì´ˆê¸°í™”
       return SomeDTO.from(entity);
   }
   ```

2. **Fetch Join ì‚¬ìš©**
   ```java
   @Query("SELECT e FROM Entity e JOIN FETCH e.lazyCollection WHERE e.id = :id")
   Optional<Entity> findByIdWithCollection(@Param("id") Long id);
   ```

3. **@EntityGraph ì‚¬ìš©**
   ```java
   @EntityGraph(attributePaths = {"lazyCollection"})
   Optional<Entity> findById(Long id);
   ```

**ì˜ˆë°©ë²•:**
- ì—”í‹°í‹°ë¥¼ ì§ì ‘ ë°˜í™˜í•˜ì§€ ë§ê³  **í•­ìƒ DTOë¡œ ë³€í™˜**
- DTO ë³€í™˜ì€ **íŠ¸ëœì­ì…˜ ë‚´**ì—ì„œ ìˆ˜í–‰
- í•„ìš”í•œ ë°ì´í„°ëŠ” **Fetch Join**ìœ¼ë¡œ í•œ ë²ˆì— ì¡°íšŒ

### 3. ì—”í‹°í‹° ì§ì ‘ ë…¸ì¶œ ë¬¸ì œ

**ë¬¸ì œ:**
- ì—”í‹°í‹°ë¥¼ API ì‘ë‹µìœ¼ë¡œ ì§ì ‘ ë°˜í™˜
- ì–‘ë°©í–¥ ê´€ê³„ â†’ ìˆœí™˜ ì°¸ì¡°
- LAZY í”„ë¡ì‹œ â†’ ì§ë ¬í™” ì‹¤íŒ¨
- ì—”í‹°í‹° ë³€ê²½ â†’ API ìŠ¤í™ ë³€ê²½

**í•´ê²°:**
- **í•­ìƒ DTO ì‚¬ìš©**
- ì—”í‹°í‹°ëŠ” ë„ë©”ì¸ ê³„ì¸µì—ë§Œ ì¡´ì¬
- DTOëŠ” í‘œí˜„ ê³„ì¸µì—ì„œë§Œ ì‚¬ìš©

**DTO íŒ¨í„´ ì˜ˆì‹œ:**
```java
// 1. Response DTO ì •ì˜
@Data
@Builder
public class SomeResponse {
    private Long id;
    private String name;
    private List<ChildResponse> children;

    public static SomeResponse from(SomeEntity entity) {
        return SomeResponse.builder()
                .id(entity.getId())
                .name(entity.getName())
                .children(entity.getChildren().stream()
                        .map(ChildResponse::from)
                        .collect(Collectors.toList()))
                .build();
    }
}

// 2. Serviceì—ì„œ DTO ë³€í™˜
@Transactional(readOnly = true)
public SomeResponse getEntity(Long id) {
    SomeEntity entity = repository.findById(id).orElseThrow();
    entity.getChildren().size();  // LAZY ì´ˆê¸°í™”
    return SomeResponse.from(entity);
}

// 3. Controllerì—ì„œ DTO ë°˜í™˜
@GetMapping("/{id}")
public ResponseEntity<SomeResponse> get(@PathVariable Long id) {
    return ResponseEntity.ok(service.getEntity(id));
}
```

**ì˜ˆë°©ë²•:**
- ì—”í‹°í‹°ëŠ” **ì ˆëŒ€ Controllerì—ì„œ ë°˜í™˜í•˜ì§€ ì•Šê¸°**
- ëª¨ë“  API ì‘ë‹µì— **ë³„ë„ DTO ìƒì„±**
- DTO ë³€í™˜ ë¡œì§ì€ **static íŒ©í† ë¦¬ ë©”ì„œë“œ** í™œìš©

### 4. Jackson ì—­ì§ë ¬í™” ë””ë²„ê¹…

**ë¬¸ì œ ë°œìƒ ì‹œ ì²´í¬ë¦¬ìŠ¤íŠ¸:**

1. **ê¸°ë³¸ ìƒì„±ì ì¡´ì¬ ì—¬ë¶€**
   ```java
   @NoArgsConstructor  // í•„ìˆ˜
   public class SomeDTO {
   ```

2. **Setter ì¡´ì¬ ì—¬ë¶€**
   ```java
   @Setter  // ë˜ëŠ” @Data
   public class SomeDTO {
   ```

3. **Record ì‚¬ìš© ì‹œ ì»´íŒŒì¼ ì˜µì…˜**
   ```gradle
   options.compilerArgs << '-parameters'
   ```

4. **í•„ë“œëª… ëŒ€ì†Œë¬¸ì ì¼ì¹˜**
   ```json
   // JSON
   {"userName": "..."}

   // DTO - ì¼ì¹˜í•´ì•¼ í•¨
   private String userName;
   ```

5. **Enum ê°’ ì¼ì¹˜**
   ```json
   // JSON
   {"status": "ACTIVE"}

   // Enum - ì •í™•íˆ ì¼ì¹˜í•´ì•¼ í•¨
   enum Status { ACTIVE, INACTIVE }
   ```

**ë””ë²„ê¹… ë„êµ¬:**
```java
// application.ymlì— ì¶”ê°€
logging:
  level:
    org.springframework.web: DEBUG
    com.fasterxml.jackson: DEBUG
```

### 5. íŠ¸ëŸ¬ë¸”ìŠˆíŒ… ì ‘ê·¼ë²•

**ì²´ê³„ì ì¸ ë¬¸ì œ í•´ê²° í”„ë¡œì„¸ìŠ¤:**

1. **ì¦ìƒ ì •í™•íˆ íŒŒì•…**
   - ì—ëŸ¬ ë©”ì‹œì§€ í™•ì¸
   - HTTP ìƒíƒœ ì½”ë“œ í™•ì¸
   - ë¡œê·¸ í™•ì¸

2. **ê´€ë ¨ ì½”ë“œ ë¦¬ë·°**
   - DTO êµ¬ì¡°
   - ì—”í‹°í‹° ê´€ê³„
   - ì„œë¹„ìŠ¤ ë¡œì§

3. **ê°€ì„¤ ìˆ˜ë¦½**
   - "Setterê°€ ì—†ì–´ì„œ ê·¸ëŸ°ê°€?"
   - "LAZY ë¡œë”© ë•Œë¬¸ì¸ê°€?"
   - "ìˆœí™˜ ì°¸ì¡° ë•Œë¬¸ì¸ê°€?"

4. **ê°€ì„¤ ê²€ì¦**
   - ì½”ë“œ ìˆ˜ì •
   - í…ŒìŠ¤íŠ¸
   - ë¡œê·¸ í™•ì¸

5. **ë¬¸ì œ í•´ê²° í›„ ë¬¸ì„œí™”**
   - ì›ì¸ ë¶„ì„
   - í•´ê²° ë°©ë²•
   - ì˜ˆë°©ë²•

**íš¨ê³¼ì ì¸ ë””ë²„ê¹… íŒ:**
- **ë¡œê·¸ë¥¼ ìì„¸íˆ ë³´ê¸°** - ìŠ¤íƒ íŠ¸ë ˆì´ìŠ¤ì— íŒíŠ¸ê°€ ë§ìŒ
- **í•œ ë²ˆì— í•˜ë‚˜ì”© ë³€ê²½** - ì—¬ëŸ¬ ê°œ ë™ì‹œì— ë°”ê¾¸ë©´ ì›ì¸ íŒŒì•… ì–´ë ¤ì›€
- **ë¹„ìŠ·í•œ ì‚¬ë¡€ ê²€ìƒ‰** - StackOverflow, GitHub Issues
- **ê³µì‹ ë¬¸ì„œ í™•ì¸** - Jackson, Spring Boot, JPA ë¬¸ì„œ

---

## ì²´í¬ë¦¬ìŠ¤íŠ¸

### API ê°œë°œ ì‹œ í™•ì¸ ì‚¬í•­

- [ ] DTOì— `@NoArgsConstructor` ìˆëŠ”ê°€?
- [ ] DTOì— `@Setter` ë˜ëŠ” `@Data` ìˆëŠ”ê°€?
- [ ] Record ì‚¬ìš© ì‹œ `-parameters` ì»´íŒŒì¼ ì˜µì…˜ ì¶”ê°€í–ˆëŠ”ê°€?
- [ ] ì—”í‹°í‹°ë¥¼ ì§ì ‘ ë°˜í™˜í•˜ì§€ ì•Šê³  DTOë¡œ ë³€í™˜í•˜ëŠ”ê°€?
- [ ] LAZY ë¡œë”© ì»¬ë ‰ì…˜ì„ íŠ¸ëœì­ì…˜ ë‚´ì—ì„œ ì´ˆê¸°í™”í•˜ëŠ”ê°€?
- [ ] ì–‘ë°©í–¥ ê´€ê³„ì—ì„œ ìˆœí™˜ ì°¸ì¡°ë¥¼ ë°©ì§€í–ˆëŠ”ê°€?
- [ ] í•„ë“œëª…ì´ ì˜¬ë°”ë¥¸ ì˜ì–´ ë¬¸ë²•ì„ ë”°ë¥´ëŠ”ê°€?
- [ ] API ì‘ë‹µ í˜•ì‹ì´ ì¼ê´€ì„± ìˆëŠ”ê°€?

### JPA ì‚¬ìš© ì‹œ í™•ì¸ ì‚¬í•­

- [ ] FetchTypeì„ ì ì ˆíˆ ì„¤ì •í–ˆëŠ”ê°€? (ê¸°ë³¸: LAZY)
- [ ] N+1 ë¬¸ì œë¥¼ ë°©ì§€í–ˆëŠ”ê°€? (Fetch Join, @EntityGraph)
- [ ] Cascade ì˜µì…˜ì´ ì ì ˆí•œê°€?
- [ ] orphanRemovalì´ í•„ìš”í•œ ê´€ê³„ì— ì„¤ì •ë˜ì—ˆëŠ”ê°€?
- [ ] ì–‘ë°©í–¥ ê´€ê³„ì—ì„œ ì—°ê´€ê´€ê³„ í¸ì˜ ë©”ì„œë“œê°€ ìˆëŠ”ê°€?
- [ ] ì—”í‹°í‹°ë¥¼ APIì— ì§ì ‘ ë…¸ì¶œí•˜ì§€ ì•ŠëŠ”ê°€?

---

## ì°¸ê³  ìë£Œ

### ê³µì‹ ë¬¸ì„œ
- [Jackson Documentation](https://github.com/FasterXML/jackson-docs)
- [Spring Data JPA Reference](https://docs.spring.io/spring-data/jpa/docs/current/reference/html/)
- [Hibernate User Guide](https://docs.jboss.org/hibernate/orm/6.0/userguide/html_single/Hibernate_User_Guide.html)

### ê´€ë ¨ ì´ìŠˆ
- [Jackson cannot deserialize Java 14 records](https://github.com/FasterXML/jackson-databind/issues/2709)
- [LazyInitializationException with Spring Boot](https://stackoverflow.com/questions/24482117)

### ì¶”ì²œ ê¸€
- [The best way to handle the LazyInitializationException](https://vladmihalcea.com/the-best-way-to-handle-the-lazyinitializationexception/)
- [The DTO pattern (Data Transfer Object)](https://martinfowler.com/eaaCatalog/dataTransferObject.html)

---

## ë§ˆì¹˜ë©°

ì´ë²ˆ íŠ¸ëŸ¬ë¸”ìŠˆíŒ…ì„ í†µí•´ ë°°ìš´ í•µì‹¬ êµí›ˆ:

1. **Java RecordëŠ” í¸ë¦¬í•˜ì§€ë§Œ Jacksonê³¼ í•¨ê»˜ ì‚¬ìš© ì‹œ ì£¼ì˜**
   - `-parameters` ì»´íŒŒì¼ ì˜µì…˜ í•„ìˆ˜

2. **ì—”í‹°í‹°ëŠ” ì ˆëŒ€ APIì— ì§ì ‘ ë…¸ì¶œí•˜ì§€ ë§ ê²ƒ**
   - í•­ìƒ DTO íŒ¨í„´ ì‚¬ìš©
   - ìˆœí™˜ ì°¸ì¡°, LAZY ë¡œë”© ë“± ë§ì€ ë¬¸ì œ ì˜ˆë°©

3. **LAZY ë¡œë”©ì€ íŠ¸ëœì­ì…˜ ê²½ê³„ë¥¼ ê³ ë ¤**
   - íŠ¸ëœì­ì…˜ ë‚´ì—ì„œ í•„ìš”í•œ ë°ì´í„° ëª¨ë‘ ë¡œë”©
   - ë˜ëŠ” Fetch Join í™œìš©

4. **ì²´ê³„ì ì¸ ë¬¸ì œ í•´ê²° ê³¼ì •ì´ ì¤‘ìš”**
   - ì¦ìƒ íŒŒì•… â†’ ì›ì¸ ë¶„ì„ â†’ ê°€ì„¤ ìˆ˜ë¦½ â†’ ê²€ì¦ â†’ í•´ê²°
   - ë¬¸ì„œí™”ë¥¼ í†µí•œ ì§€ì‹ ì¶•ì 

ì´ ë¬¸ì„œê°€ í–¥í›„ ìœ ì‚¬í•œ ë¬¸ì œë¥¼ í•´ê²°í•˜ëŠ” ë° ë„ì›€ì´ ë˜ê¸°ë¥¼ ë°”ëë‹ˆë‹¤! ğŸš€
